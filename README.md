# SmartPickingRobot - 智慧采摘机器人系统

## 项目简介
SmartPickingRobot 是一套面向果蔬采摘场景的智能化机器人系统，集成 **K210视觉识别、小车底盘远程控制、六轴机械臂精准操控** 三大核心能力，通过三层组网架构实现“决策-转发-执行”的全流程自动化，可完成目标果蔬的自动识别、定位、抓取与搬运，并提供可视化UI交互界面，具备良好的扩展性与协同性。


## 一、系统组网架构
系统采用 **三层分层架构** 设计，实现功能解耦与高效数据流转，各层级职责明确、通过标准化协议通信。

| 架构层级       | 核心硬件          | 核心职责                                  | 数据交互方式                  |
|----------------|-------------------|-------------------------------------------|-------------------------------|
| 决策层（Layer3）| A7开发板          | 高级决策、UI界面运行、主控逻辑、MQTT指令发布 | 发布/订阅MQTT主题             |
| 枢纽层（Layer2）| STM32主控 + ESP8266 | 协议转发、指令解析、设备协调、数据路由      | UART（串口）、WiFi（MQTT）    |
| 执行与感知层（Layer1）| K210视觉模块、六轴机械臂、小车（电机+传感器） | 原始数据采集（视觉识别）、执行动作（抓取/移动） | GPIO/PWM（小车控制）、UART（机械臂/K210） |

### 层级连接关系
1. 决策层 → 枢纽层：A7开发板通过 **MQTT协议** 向ESP8266发送控制指令（小车方向、机械臂角度）。
2. 枢纽层 → 执行层：STM32通过 **串口1** 转发机械臂指令、**GPIO/PWM** 控制小车电机、**串口3** 接收K210识别数据。
3. 执行层 → 决策层：K210识别结果经STM32解析后，由ESP8266通过 **MQTT协议** 上报至A7开发板。


## 二、核心模块详解
### 2.1 决策层：A7开发板（核心决策单元）
#### 2.1.1 开发环境与部署
- 系统环境：Linux 操作系统
- 开发框架：Qt 框架（用于上位机UI开发）
- 部署方式：通过串口烧录Qt应用，将界面部署到开发板自带显示屏。

#### 2.1.2 核心功能
- **指令发布**：通过订阅/发布不同MQTT主题，发送控制指令：
  - 小车控制：发布小车行进方向、速度指令。
  - 机械臂控制：发布六轴关节角度、夹爪开合指令。
- **数据接收**：订阅MQTT主题 `k210/result`，接收STM32转发的K210果蔬识别结果（含果蔬类型、置信度、位置）。
- **状态展示**：在UI界面实时显示设备连接状态、小车/机械臂参数、识别结果日志。

### 2.2 枢纽层：STM32主控 + ESP8266（通信与转发中心）
#### 2.2.1 硬件连接与协议
| 连接对象       | 串口/接口       | 功能用途                                  |
|----------------|-----------------|-------------------------------------------|
| ESP8266（WiFi）| 串口2           | 接收A7的MQTT指令，转发K210识别结果至MQTT  |
| 六轴机械臂     | 串口1           | 转发A7的机械臂关节角度、夹爪控制指令      |
| K210视觉模块   | 串口3           | 接收K210的果蔬识别原始数据（如类型、位置）|
| 小车电机       | GPIO/PWM        | 解析指令后输出PWM信号，控制小车方向与速度  |

#### 2.2.2 核心功能
- **协议转发**：统一解析A7下发的指令，按设备类型转发至对应执行单元（机械臂/小车）。
- **数据预处理**：将K210的识别数据转换为JSON格式，通过ESP8266上报至MQTT服务器。
- **设备协调**：确保小车移动与机械臂抓取动作的时序协同，避免冲突。

### 2.3 执行与感知层：终端执行单元
#### 2.3.1 K210视觉模块
- 核心功能：实时识别果蔬（如苹果），输出识别结果（类型、置信度、位置坐标 `(x,y,w,h)`、品质）。
- 数据传输：通过串口3将识别结果发送至STM32，触发后续抓取动作。

#### 2.3.2 六轴机械臂
- 控制方式：接收STM32串口1转发的指令，调整各关节角度（关节1~3）与夹爪开合度（夹爪a/g）。
- 应用场景：根据K210定位的果蔬位置，完成精准抓取与搬运。

#### 2.3.3 小车底盘
- 控制方式：STM32通过GPIO/PWM输出信号，控制电机转速与方向。
- 功能支持：支持手动控制（方向、速度）与巡线模式（待扩展），适配采摘场景的移动需求。

### 2.4 MQTT通信系统（设备协同中枢）
#### 2.4.1 MQTT服务器
- 选型：**EMQX MQTT Broker**
- 核心作用：实现发布者（A7/ESP8266）与订阅者（ESP8266/A7）的解耦，中转所有指令与数据。

#### 2.4.2 关键MQTT Topic列表
| 业务场景       | 发布者          | 订阅者          | Topic路径       | 数据内容                          |
|----------------|-----------------|-----------------|----------------|-----------------------------------|
| 小车控制       | A7开发板（QT）  | ESP8266         | `car/direction` | 行进方向（前/后/左/右）、速度（快/慢） |
| 机械臂控制     | A7开发板（QT）  | ESP8266         | `arm/control`  | 关节1~3角度、夹爪a/g开合度        |
| K210识别结果上报 | ESP8266         | A7开发板（QT）  | `k210/result`  | 果蔬类型、置信度、位置、品质      |

### 2.5 UI客户端（Qt上位机）
提供两大核心界面，支持可视化操作与状态监控：

#### 2.5.1 控制面板界面（EQUIPMENT）
- 功能：实时控制小车与机械臂，显示设备状态。
- 核心元素：
  - 设备状态：连接/断开状态提示。
  - 小车控制：底盘参数、巡线模式（关/开）、速度调节（快/慢）。
  - 机械臂控制：关节1~3角度调节（如关节1：140）、夹爪a/g开合度调节（如夹爪a：250）。
  - 辅助功能：行迹日志显示、日志清除、设备重启（RESTART）。

#### 2.5.2 识别回显界面（COLLECTION）
- 功能：展示K210视觉识别结果与历史记录。
- 核心元素：
  - 识别结果区：表格展示编号、果蔬类型、置信度、位置坐标、品质。
  - 历史捕获区：显示过往识别的果蔬图像。
  - 辅助功能：图像清除、重新获取识别结果（GET）。


## 三、核心功能亮点
1. **分层解耦架构**：决策、转发、执行三层独立设计，便于模块替换与功能扩展（如新增传感器）。
2. **多设备协同**：视觉识别（K210）、移动（小车）、抓取（机械臂）联动，实现采摘全流程自动化。
3. **可视化交互**：Qt界面直观展示设备状态与识别结果，支持手动控制与参数调节，降低操作门槛。
4. **标准化通信**：基于MQTT与UART协议，确保指令与数据传输的稳定性和可扩展性。


## 四、部署步骤
1. **硬件连接**
   - 按层级连接硬件：A7→ESP8266（串口2）、STM32→机械臂（串口1）、STM32→K210（串口3）、STM32→小车（GPIO/PWM）。
   - 为ESP8266配置WiFi，确保连接本地EMQX MQTT服务器。

2. **MQTT服务器部署**
   - 安装EMQX Broker（支持Windows/Linux），启动服务并确认端口可访问。
   - 无需额外配置Topic，系统自动通过预设路径通信。

3. **上位机（A7开发板）部署**
   - 在Linux环境下用Qt编译UI应用，通过串口烧录至A7开发板。
   - 启动应用，输入MQTT服务器地址，完成设备连接。

4. **下位机（STM32/K210）配置**
   - 烧录STM32协议转发程序与K210视觉识别程序。
   - 校准机械臂关节角度与小车电机PWM参数，确保动作精准。


## 五、待优化方向
1. **UI功能完善**：增加WiFi网络选择功能；新增识别影像实时传输模块，支持界面查看K210拍摄画面。
2. **数据存储扩展**：引入SQLite3数据库，存储行迹日志与果蔬识别历史结果，支持数据回溯与分析。
3. **通信与指令优化**：对K210识别结果进行加密传输；统一指令格式（如标准化JSON结构），减少解析复杂度。
4. **自动化能力提升**：开发自动抓取逻辑，实现“识别→小车定位→机械臂抓取”全流程无人干预；引入PID算法优化小车速度控制与机械臂动作平滑度。


## 六、贡献与许可证
- **贡献方式**：欢迎提交Issue反馈功能缺陷或需求，也可通过Pull Request提交代码优化（建议先与维护者同步开发计划）。
- **许可证**：本项目采用MIT许可证，允许非商业与商业用途，修改或二次开发后需保留原始版权声明。

![【哲风壁纸】书架-书桌文具](https://github.com/user-attachments/assets/d0037209-d5f4-49bd-81ba-d778f93fe25c)

